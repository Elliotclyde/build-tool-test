function parse(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,o="";if("?"===e[f=t+1])throw new TypeError('Pattern cannot start with "?" at '+f);for(;f<e.length;)if("\\"!==e[f]){if(")"===e[f]){if(0===--i){f++;break}}else if("("===e[f]&&(i++,"?"!==e[f+1]))throw new TypeError("Capturing groups are not allowed at "+f);o+=e[f++]}else o+=e[f++]+e[f++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:o}),t=f}else{for(var a="",f=t+1;f<e.length;){var p=e.charCodeAt(f);if(!(p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||95===p))break;a+=e[f++]}if(!a)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:a}),t=f}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),n=r.prefixes,i=void 0===n?"./":n,o="[^"+escapeString(r.delimiter||"/#?")+"]+?",a=[],f=0,p=0,u="",tryConsume=function(e){if(p<t.length&&t[p].type===e)return t[p++].value},mustConsume=function(e){var r=tryConsume(e);if(void 0!==r)return r;var n=t[p],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},consumeText=function(){for(var e,r="";e=tryConsume("CHAR")||tryConsume("ESCAPED_CHAR");)r+=e;return r};p<t.length;){var s=tryConsume("CHAR"),c=tryConsume("NAME"),d=tryConsume("PATTERN");if(c||d){var v=s||"";-1===i.indexOf(v)&&(u+=v,v=""),u&&(a.push(u),u=""),a.push({name:c||f++,prefix:v,suffix:"",pattern:d||o,modifier:tryConsume("MODIFIER")||""})}else{var l=s||tryConsume("ESCAPED_CHAR");if(l)u+=l;else if(u&&(a.push(u),u=""),tryConsume("OPEN")){v=consumeText();var x=tryConsume("NAME")||"",g=tryConsume("PATTERN")||"",h=consumeText();mustConsume("CLOSE"),a.push({name:x||(g?f++:""),pattern:x&&!g?o:g,prefix:v,suffix:h,modifier:tryConsume("MODIFIER")||""})}else mustConsume("END")}}return a}function compile(e,r){return tokensToFunction(parse(e,r),r)}function tokensToFunction(e,r){void 0===r&&(r={});var t=flags(r),n=r.encode,i=void 0===n?function(e){return e}:n,o=r.validate,a=void 0===o||o,f=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var p=r?r[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,s="*"===o.modifier||"+"===o.modifier;if(Array.isArray(p)){if(!s)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===p.length){if(u)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var c=0;c<p.length;c++){var d=i(p[c],o);if(a&&!f[n].test(d))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+d+'"');t+=o.prefix+d+o.suffix}}else if("string"!=typeof p&&"number"!=typeof p){if(!u){var v=s?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+v)}}else{d=i(String(p),o);if(a&&!f[n].test(d))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+d+'"');t+=o.prefix+d+o.suffix}}else t+=o}return t}}function match(e,r){var t=[];return regexpToFunction(pathToRegexp(e,t,r),t,r)}function regexpToFunction(e,r,t){void 0===t&&(t={});var n=t.decode,i=void 0===n?function(e){return e}:n;return function(t){var n=e.exec(t);if(!n)return!1;for(var o=n[0],a=n.index,f=Object.create(null),_loop_1=function(e){if(void 0===n[e])return"continue";var t=r[e-1];"*"===t.modifier||"+"===t.modifier?f[t.name]=n[e].split(t.prefix+t.suffix).map((function(e){return i(e,t)})):f[t.name]=i(n[e],t)},p=1;p<n.length;p++)_loop_1(p);return{path:o,index:a,params:f}}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function tokensToRegexp(e,r,t){void 0===t&&(t={});for(var n=t.strict,i=void 0!==n&&n,o=t.start,a=void 0===o||o,f=t.end,p=void 0===f||f,u=t.encode,s=void 0===u?function(e){return e}:u,c="["+escapeString(t.endsWith||"")+"]|$",d="["+escapeString(t.delimiter||"/#?")+"]",v=a?"^":"",l=0,x=e;l<x.length;l++){var g=x[l];if("string"==typeof g)v+=escapeString(s(g));else{var h=escapeString(s(g.prefix)),m=escapeString(s(g.suffix));if(g.pattern)if(r&&r.push(g),h||m)if("+"===g.modifier||"*"===g.modifier){var E="*"===g.modifier?"?":"";v+="(?:"+h+"((?:"+g.pattern+")(?:"+m+h+"(?:"+g.pattern+"))*)"+m+")"+E}else v+="(?:"+h+"("+g.pattern+")"+m+")"+g.modifier;else v+="("+g.pattern+")"+g.modifier;else v+="(?:"+h+m+")"+g.modifier}}if(p)i||(v+=d+"?"),v+=t.endsWith?"(?="+c+")":"$";else{var y=e[e.length-1],T="string"==typeof y?d.indexOf(y[y.length-1])>-1:void 0===y;i||(v+="(?:"+d+"(?="+c+"))?"),T||(v+="(?="+d+"|"+c+")")}return new RegExp(v,flags(t))}function pathToRegexp(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=t.exec(e.source);i;)r.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(e.source);return e}(e,r):Array.isArray(e)?function(e,r,t){var n=e.map((function(e){return pathToRegexp(e,r,t).source}));return new RegExp("(?:"+n.join("|")+")",flags(t))}(e,r,t):function(e,r,t){return tokensToRegexp(parse(e,t),r,t)}(e,r,t)}export{compile,match,parse,pathToRegexp,regexpToFunction,tokensToFunction,tokensToRegexp};